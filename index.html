# Retry writing the file after a kernel reset.
from pathlib import Path, PurePosixPath

html_path = Path("/mnt/data/simple-timer-app.html")
html_path.write_text("""<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Workout Buddy — Simple Timer</title>
<meta name="theme-color" content="#0f0f13">
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
  :root{--bg:#0f1117; --card:#171a22; --ink:#fff; --muted:#aab; --accent:#ffd54a; --ok:#7cfc9c; --danger:#ff6868;}
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif; background:radial-gradient(1100px 700px at 50% -10%, #263049 0%, #0f1117 55%); color:var(--ink)}
  .wrap{max-width:520px; margin:0 auto; padding:12px 12px 140px}
  header{position:sticky; top:0; z-index:5; padding:10px 0; backdrop-filter:blur(8px) saturate(120%); background:linear-gradient(#0f111799,#0f111700)}
  .brand{display:flex; align-items:center; gap:10px}
  .brand img{width:42px;height:42px; image-rendering:pixelated}
  .brand h1{margin:0; font-size:20px; font-weight:800; letter-spacing:.3px}
  .sub{font-size:12px; color:#cfd2ffb0}
  .card{background:linear-gradient(180deg,#1c2030,#141824); border:1px solid #2a2f48; border-radius:16px; padding:14px; margin:12px 0; box-shadow:0 10px 26px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.05)}
  textarea{width:100%; min-height:160px; resize:vertical; padding:12px; border-radius:10px; background:#0e1220; border:1px solid #2a2f48; color:#fff}
  .row{display:flex; gap:8px; align-items:center}
  .btn{appearance:none; border:none; padding:12px 14px; border-radius:12px; font-weight:800; cursor:pointer}
  .btn.primary{background:linear-gradient(90deg,#ffd54a,#ffe68b); color:#0d1015}
  .btn.ghost{background:#192034; color:#fff; border:1px solid #2a314f}
  .muted{color:#b9bfeebb; font-size:12px}
  .days{display:grid; grid-template-columns:repeat(7,1fr); gap:6px; margin-top:10px}
  .chip{padding:10px 0; text-align:center; border-radius:10px; border:1px solid #2a2f48; background:#0f1426; font-weight:800; cursor:pointer; user-select:none}
  .chip.on{background:#203055; border-color:#3a4c7a}
  .list .ex{display:flex; align-items:center; justify-content:space-between; background:#0e1324; border:1px solid #20284a; border-radius:12px; padding:10px 12px; margin-top:8px}
  .list .ex .meta{font-size:12px; color:#cbd1ffcc}
  .screen{position:fixed; inset:0; background:#0b0d18; display:none; z-index:20}
  .screen.on{display:flex}
  .stage{display:flex; flex-direction:column; justify-content:space-between; align-items:center; width:100%; height:100%; padding:20px 16px 28px}
  .sprite{flex:1; display:flex; align-items:center; justify-content:center; width:100%}
  .sprite img{width:min(90vw,520px); max-height:60vh; object-fit:contain; image-rendering:pixelated}
  .time{font-size:64px; line-height:1; font-weight:800; letter-spacing:1px}
  .phase{font-size:14px; text-transform:uppercase; letter-spacing:1px; color:#cdd3ffcc; margin-top:4px}
  .bar{display:flex; gap:10px; width:100%}
  .bar .btn{flex:1}
  .btn.work{background:linear-gradient(90deg,#7cfc9c,#cfffde); color:#0f1a14}
  .btn.rest{background:#1c253f; color:#fff; border:1px solid #2a3355}
  .btn.stop{background:#2a1919; color:#ff9f9f; border:1px solid #4a2323}
  .hdr{font-weight:800; font-size:14px}
</style>
</head>
<body>
<header>
  <div class="wrap" style="padding-bottom:0">
    <div class="brand">
      <img src="logo.png" alt="" onerror="this.style.display='none'">
      <div>
        <h1>Workout Buddy</h1>
        <div class="sub">Paste routine → Pick days → Big pixel timer.</div>
      </div>
    </div>
  </div>
</header>

<main class="wrap">
  <section class="card">
    <div class="hdr">1) Paste your routine</div>
    <textarea id="routine"></textarea>
    <div class="row" style="margin-top:8px">
      <button id="loadExample" class="btn ghost">Load example</button>
      <button id="buildWeek" class="btn primary">Build week</button>
    </div>
    <div class="muted" style="margin-top:6px">Format: each exercise on 3 lines — Name, “Reps: …”, “Tip: …”. Blank line between exercises.</div>
  </section>

  <section class="card">
    <div class="hdr">2) Choose training days</div>
    <div id="days" class="days"></div>
    <div class="muted">Same routine is used on each selected day (simple by design).</div>
  </section>

  <section class="card">
    <div class="hdr">3) Today</div>
    <div id="today" class="muted">Build your week to see today’s plan.</div>
    <div class="list" id="planList"></div>
  </section>
</main>

<section id="screen" class="screen" aria-live="polite">
  <div class="stage">
    <div class="sprite"><img id="sprite" src="rest_1.png" alt=""></div>
    <div style="text-align:center">
      <div class="time" id="clock">00:00</div>
      <div class="phase" id="phase">Ready</div>
      <div class="phase" id="progress"></div>
    </div>
    <div class="bar">
      <button class="btn work" id="startBtn">Start set</button>
      <button class="btn rest" id="skipBtn">Skip rest</button>
      <button class="btn stop" id="closeBtn">Close</button>
    </div>
  </div>
</section>

<script>
(function(){
  const $ = s=>document.querySelector(s);
  const daysEl = $('#days'); const routineEl=$('#routine'); const planList=$('#planList'); const todayLbl=$('#today');

  const dayNames = ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
  const activeDays = Array(7).fill(true);
  function renderDays(){
    daysEl.innerHTML='';
    dayNames.forEach((d,i)=>{
      const b=document.createElement('div'); b.className='chip on'; b.textContent=d;
      b.onclick=()=>{ activeDays[i]=!activeDays[i]; b.classList.toggle('on',activeDays[i]); renderToday(); };
      daysEl.appendChild(b);
    });
  }
  renderDays();

  function parseRoutine(text){
    const blocks = text.trim().split(/\\n\\s*\\n/).filter(Boolean);
    const items = [];
    for(const blk of blocks){
      const lines = blk.split(/\\n/).map(s=>s.trim()).filter(Boolean);
      if(!lines.length) continue;
      const name = lines[0];
      const repsLine = (lines.find(x=>/^reps:/i.test(x))||'').replace(/^reps:\\s*/i,'');
      const tip = (lines.find(x=>/^tip:/i.test(x))||'').replace(/^tip:\\s*/i,'');
      const setsMatch = repsLine.match(/(\\d+)\\s*[x×]/i);
      const sets = setsMatch ? parseInt(setsMatch[1],10) : 3;
      items.push({ name, repsText: repsLine || '', sets, tip, rest: recommendRest(name, repsLine) });
    }
    return items;
  }
  function recommendRest(name, repsText){
    const low = /\\b(squat|deadlift|row)\\b/i.test(name) ? 75 : 60;
    if(/15\\+|12\\s*–\\s*15|12-15/i.test(repsText)) return 50;
    if(/10\\s*–\\s*12|10-12/i.test(repsText)) return low;
    return 60;
  }

  let plan = [];
  function buildWeek(){
    plan = parseRoutine(routineEl.value);
    if(!plan.length){ alert('Could not find any exercises. Please check the format.'); return; }
    renderToday();
  }

  function renderToday(){
    const todayIdx = (new Date().getDay()+6)%7;
    const isActive = activeDays[todayIdx];
    todayLbl.textContent = isActive ?
      `It's ${dayNames[todayIdx]}. ${plan.length? 'Ready when you are.' : 'Paste a routine and Build week.'}` :
      `${dayNames[todayIdx]} is OFF. Toggle a day chip to change.`;

    planList.innerHTML='';
    if(!isActive || !plan.length) return;
    plan.forEach((ex, i)=>{
      const row=document.createElement('div'); row.className='ex';
      const left=document.createElement('div');
      left.innerHTML = `<div style="font-weight:800">${ex.name}</div>
                        <div class="meta">${ex.repsText || (ex.sets+' sets')} · Rest ${ex.rest}s</div>
                        <div class="meta" style="opacity:.85">${ex.tip || ''}</div>`;
      const btn=document.createElement('button'); btn.className='btn ghost'; btn.textContent='Start';
      btn.onclick=()=>startExercise(i);
      row.appendChild(left); row.appendChild(btn); planList.appendChild(row);
    });
  }

  const screen=$('#screen'), sprite=$('#sprite'), clock=$('#clock'), phase=$('#phase'), progress=$('#progress');
  const startBtn=$('#startBtn'), skipBtn=$('#skipBtn'), closeBtn=$('#closeBtn');
  const workFrames = ['loading_1.png','loading_2.png','loading_3.png','loading_4.png'];
  const restFrames = ['rest_1.png','rest_2.png'];
  let frameIx=0, frameLoop=null, timer=null;

  let flow=null;
  function startExercise(idx){
    const ex = plan[idx];
    flow={ idx, set:1, mode:'idle', rest:ex.rest, sets:ex.sets, name:ex.name };
    openScreen();
    updateProgress();
    phase.textContent='Ready'; clock.textContent='00:00'; sprite.src=restFrames[0];
  }
  function updateProgress(){ progress.textContent = `${flow.name} — Set ${flow.set}/${flow.sets}`; }

  function openScreen(){ screen.classList.add('on'); }
  function closeScreen(){ screen.classList.remove('on'); clearInterval(timer); clearInterval(frameLoop); }
  closeBtn.onclick=closeScreen;

  function animate(frames, speed){ clearInterval(frameLoop); frameIx=0; sprite.src=frames[0]; frameLoop=setInterval(()=>{ frameIx=(frameIx+1)%frames.length; sprite.src=frames[frameIx]; }, speed); }
  function fmt(n){ const m=String(Math.floor(n/60)).padStart(2,'0'); const s=String(n%60).padStart(2,'0'); return `${m}:${s}`; }

  startBtn.onclick=()=>{
    if(!flow) return;
    if(flow.mode==='idle' || flow.mode==='resting'){
      flow.mode='working'; animate(workFrames, 160);
      let t=0; clock.textContent=fmt(t); phase.textContent='WORK';
      clearInterval(timer);
      timer=setInterval(()=>{ t++; clock.textContent=fmt(t); },1000);
      startBtn.textContent='Stop set';
      startBtn.className='btn stop';
    } else if(flow.mode==='working'){
      clearInterval(timer);
      rest();
    }
  };
  function rest(){
    flow.mode='resting'; animate(restFrames, 650);
    let t=flow.rest; clock.textContent=fmt(t); phase.textContent='REST';
    startBtn.textContent='Add +10s'; startBtn.className='btn rest';
    clearInterval(timer);
    timer=setInterval(()=>{ t--; clock.textContent=fmt(Math.max(0,t)); if(t<=0){ clearInterval(timer); nextSet(); } },1000);
    startBtn.onclick=()=>{ t+=10; clock.textContent=fmt(t); };
  }
  function nextSet(){
    flow.set++;
    if(flow.set<=flow.sets){
      phase.textContent='Ready'; clock.textContent='00:00'; startBtn.textContent='Start set'; startBtn.className='btn work';
      startBtn.onclick=()=>{ 
        flow.mode='working'; animate(workFrames, 160);
        let t=0; clock.textContent=fmt(t); phase.textContent='WORK';
        clearInterval(timer); timer=setInterval(()=>{ t++; clock.textContent=fmt(t); },1000);
        startBtn.textContent='Stop set'; startBtn.className='btn stop'; startBtn.onclick=()=>{ clearInterval(timer); rest(); };
      };
      updateProgress();
    }else{
      const next = flow.idx+1;
      if(next < plan.length){
        flow={ idx:next, set:1, mode:'idle', rest:plan[next].rest, sets:plan[next].sets, name:plan[next].name };
        updateProgress();
        phase.textContent='Next Exercise Ready'; clock.textContent='00:00'; startBtn.textContent='Start set'; startBtn.className='btn work';
        startBtn.onclick=()=>{
          flow.mode='working'; animate(workFrames,160); let t=0; clock.textContent=fmt(t); phase.textContent='WORK';
          clearInterval(timer); timer=setInterval(()=>{ t++; clock.textContent=fmt(t); },1000);
          startBtn.textContent='Stop set'; startBtn.className='btn stop'; startBtn.onclick=()=>{ clearInterval(timer); rest(); };
        };
      }else{
        phase.textContent='Workout Complete'; clock.textContent='DONE'; startBtn.textContent='Close'; startBtn.className='btn work'; startBtn.onclick=closeScreen;
      }
    }
  }
  skipBtn.onclick=()=>{ if(flow?.mode==='resting'){ clearInterval(timer); nextSet(); } };

  const example = `Dumbbell Bench Press
Reps: 4×8–12
Tip: Feet flat, slight arch in back, lower weights slowly, squeeze chest at the top.

Dumbbell Shoulder Press
Reps: 4×8–12
Tip: Sit upright, avoid flaring elbows too much.

Dumbbell Lateral Raises
Reps: 3×12–15
Tip: Raise to shoulder height, control on the way down.

Goblet Squats
Reps: 4×12
Tip: Chest up, knees out, squat to at least parallel.

Romanian Deadlifts
Reps: 4×10
Tip: Keep slight knee bend, hinge at hips, back flat.

Dumbbell Rows
Reps: 3×10 each side
Tip: Support your body with the other arm on the bench. Pull dumbbell to waist.`;
  $('#loadExample').onclick=()=>{ routineEl.value = example; };

  $('#buildWeek').onclick=()=>buildWeek();

  ['loading_1.png','loading_2.png','loading_3.png','loading_4.png','rest_1.png','rest_2.png'].forEach(src=>{ const i=new Image(); i.src=src; });
})();
</script>
</body>
</html>
""")
str(html_path)
